# Agent Engine

ä¸€ä¸ªçµæ´»çš„ AI ä»£ç†å¼•æ“ï¼Œæ”¯æŒå¤šä¸ª LLM æä¾›å•†å’Œæ¨¡å‹çš„ç»Ÿä¸€è°ƒç”¨æ¥å£ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ”Œ **å¤šæä¾›å•†æ”¯æŒ**ï¼šæ”¯æŒé…ç½®å¤šä¸ª LLM æä¾›å•†ï¼ˆå¦‚ DeepSeekã€OpenRouter ç­‰ï¼‰
- ğŸ¯ **å¤šæ¨¡å‹åˆ‡æ¢**ï¼šæ”¯æŒåœ¨ä¸åŒæä¾›å•†çš„å¤šä¸ªæ¨¡å‹ä¹‹é—´çµæ´»åˆ‡æ¢
- ğŸ“ **å‘½ä»¤è¡Œæ¥å£**ï¼šæä¾›ç®€æ´çš„å‘½ä»¤è¡Œå‚æ•°ï¼Œæ–¹ä¾¿é›†æˆå’Œè°ƒç”¨
- ğŸ¨ **Markdown æ¸²æŸ“**ï¼šè‡ªåŠ¨å°†å“åº”å†…å®¹æ¸²æŸ“ä¸ºç¾è§‚çš„ Markdown æ ¼å¼
- ğŸ“Š **JSON è¾“å‡º**ï¼šæ”¯æŒ JSON æ ¼å¼è¾“å‡ºå’Œ JSONPath æå–
- ğŸ” **æŸ¥è¯¢åŠŸèƒ½**ï¼šæ”¯æŒå‘ LLM å‘é€æŸ¥è¯¢å¹¶è·å–å›å¤ï¼ˆåŒ…å«æ¨ç†è¿‡ç¨‹ï¼‰
- ğŸ“‹ **åˆ—è¡¨åŠŸèƒ½**ï¼šåˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„æä¾›å•†å’Œæ¨¡å‹ä¿¡æ¯
- ğŸ“ **æ—¥å¿—è®°å½•**ï¼šè‡ªåŠ¨è®°å½•è¿è¡Œæ—¥å¿—åˆ°æ–‡ä»¶

## ç³»ç»Ÿè¦æ±‚

- Go 1.25.1 æˆ–æ›´é«˜ç‰ˆæœ¬
- æ”¯æŒçš„æ“ä½œç³»ç»Ÿï¼šLinuxã€macOSã€Windows

## å®‰è£…

### 1. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd agent_engine
```

### 2. å®‰è£…ä¾èµ–

```bash
go mod download
```

### 3. ç¼–è¯‘é¡¹ç›®

```bash
go build -o agent_engine
```

## é…ç½®

### é…ç½®æ–‡ä»¶ç»“æ„

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `conf.yaml` é…ç½®æ–‡ä»¶ï¼ˆæˆ–ä½¿ç”¨ `-f` å‚æ•°æŒ‡å®šè·¯å¾„ï¼‰ï¼š

```yaml
provider:
  - name: deepseek              # æä¾›å•†åç§°
    api_key: sk-xxx             # API å¯†é’¥
    base_url: https://api.deepseek.com/v1  # API åŸºç¡€ URL
    model:                      # æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨
      - deepseek-chat
      - deepseek-reasoner
  - name: openroute
    api_key: sk-or-v1-xxx
    base_url: https://openrouter.ai/api/v1
    model:
      - tngtech/deepseek-r1t2-chimera:free
```

### é…ç½®è¯´æ˜

- `name`: æä¾›å•†çš„å”¯ä¸€æ ‡è¯†åç§°
- `api_key`: æä¾›å•†çš„ API å¯†é’¥ï¼ˆæ•æ„Ÿä¿¡æ¯ï¼Œè¯·å¦¥å–„ä¿ç®¡ï¼‰
- `base_url`: æä¾›å•†çš„ API åŸºç¡€ URL
- `model`: è¯¥æä¾›å•†æ”¯æŒçš„æ¨¡å‹åˆ—è¡¨

**æ³¨æ„**ï¼š
- å¦‚æœä¸æŒ‡å®šæä¾›å•†ï¼Œå°†ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„ç¬¬ä¸€ä¸ªæä¾›å•†
- å¦‚æœä¸æŒ‡å®šæ¨¡å‹ï¼Œå°†ä½¿ç”¨è¯¥æä¾›å•†çš„ç¬¬ä¸€ä¸ªæ¨¡å‹

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬å‘½ä»¤æ ¼å¼

```bash
./agent_engine [é€‰é¡¹]
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | ç®€å†™ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `--command` | `-c` | `query` | å‘½ä»¤ç±»å‹ï¼Œå¯é€‰å€¼ï¼š`query`ï¼ˆæŸ¥è¯¢ï¼‰ã€`list`ï¼ˆåˆ—è¡¨ï¼‰ |
| `--conf` | `-f` | `./conf.yaml` | é…ç½®æ–‡ä»¶è·¯å¾„ |
| `--extract` | `-e` | `$` | æå– JSON å“åº”ä¸­çš„æŒ‡å®šå­—æ®µï¼ˆJSONPath æ ¼å¼ï¼‰ |
| `--model` | `-m` | `` | æŒ‡å®šä½¿ç”¨çš„æ¨¡å‹åç§° |
| `--params` | `-p` | `` | å‚æ•°ï¼ˆå­—ç¬¦ä¸²æˆ– JSON æ ¼å¼ï¼‰ |
| `--provider` | | `` | æŒ‡å®šä½¿ç”¨çš„æä¾›å•†åç§° |

### ä½¿ç”¨ç¤ºä¾‹

#### 1. åŸºæœ¬æŸ¥è¯¢

```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å‘é€æŸ¥è¯¢
./agent_engine -c query -p "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ"
```

#### 2. æŒ‡å®šæä¾›å•†å’Œæ¨¡å‹

```bash
# ä½¿ç”¨ deepseek æä¾›å•†çš„ deepseek-chat æ¨¡å‹
./agent_engine -c query --provider deepseek -m deepseek-chat -p "è§£é‡Šé‡å­è®¡ç®—"
```

#### 3. ä½¿ç”¨ JSON æ ¼å¼å‚æ•°

```bash
# ä½¿ç”¨ JSON æ ¼å¼ä¼ é€’å‚æ•°
./agent_engine -c query -p '{"query":"ä»‹ç»ä¸€ä¸‹ Go è¯­è¨€"}'
```

#### 4. æå–ç‰¹å®šå­—æ®µ

```bash
# åªæå–å›å¤å†…å®¹ï¼ˆä¸åŒ…å«å®Œæ•´å“åº”ç»“æ„ï¼‰
./agent_engine -c query -p "ä½ å¥½" -e "$.data.reply"

# æå–æ¨ç†è¿‡ç¨‹
./agent_engine -c query -p "1+1=?" -e "$.data.think"
```

#### 5. åˆ—å‡ºæ‰€æœ‰æä¾›å•†å’Œæ¨¡å‹

```bash
# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„æä¾›å•†å’Œæ¨¡å‹
./agent_engine -c list
```

#### 6. æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„

```bash
# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
./agent_engine -c query -f /path/to/config.yaml -p "æµ‹è¯•æŸ¥è¯¢"
```

### å“åº”æ ¼å¼

#### JSON æ ¼å¼ï¼ˆé»˜è®¤ï¼‰

å½“ä½¿ç”¨ `-e $` æˆ–ä¸æŒ‡å®š `-e` å‚æ•°æ—¶ï¼Œè¿”å›å®Œæ•´çš„ JSON å“åº”ï¼š

```json
{
  "code": 0,
  "data": {
    "query": "ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ",
    "reply": "äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰æ˜¯...",
    "think": "æ¨ç†è¿‡ç¨‹..."
  },
  "message": "success"
}
```

#### Markdown æ ¼å¼

å½“ä½¿ç”¨ `-e` æå–ç‰¹å®šå­—æ®µæ—¶ï¼Œè¾“å‡ºä¼šè‡ªåŠ¨æ¸²æŸ“ä¸º Markdown æ ¼å¼ï¼Œæ”¯æŒï¼š
- è‡ªé€‚åº”ç»ˆç«¯å®½åº¦
- è¯­æ³•é«˜äº®
- æ ¼å¼åŒ–æ˜¾ç¤º

### å“åº”ç è¯´æ˜

| Code | è¯´æ˜ |
|------|------|
| `0` | æˆåŠŸ |
| `404` | æœªæ‰¾åˆ°å¯¹åº”äº‹ä»¶å¤„ç†å™¨ |
| `500` | å†…éƒ¨é”™è¯¯ |

## æ—¥å¿—

ç¨‹åºè¿è¡Œæ—¥å¿—ä¼šè‡ªåŠ¨ä¿å­˜åˆ° `./agent_engine_logs/log.txt` æ–‡ä»¶ä¸­ï¼ŒåŒ…å«ï¼š
- é…ç½®åŠ è½½ä¿¡æ¯
- æä¾›å•†å’Œæ¨¡å‹é€‰æ‹©ä¿¡æ¯
- API è°ƒç”¨çš„åŸå§‹å“åº”
- é”™è¯¯ä¿¡æ¯

## é¡¹ç›®ç»“æ„

```
agent_engine/
â”œâ”€â”€ agent/                  # ä»£ç†å¼•æ“æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ engine.go          # Engine ä¸»é€»è¾‘
â”‚   â”œâ”€â”€ query_handler.go   # æŸ¥è¯¢å¤„ç†å™¨
â”‚   â””â”€â”€ list_handler.go    # åˆ—è¡¨å¤„ç†å™¨
â”œâ”€â”€ conf/                   # é…ç½®ç›¸å…³
â”‚   â”œâ”€â”€ config.go          # é…ç½®åŠ è½½é€»è¾‘
â”‚   â””â”€â”€ config_template.yaml # é…ç½®æ¨¡æ¿
â”œâ”€â”€ constant/              # å¸¸é‡å®šä¹‰
â”œâ”€â”€ model/                 # æ•°æ®æ¨¡å‹
â”œâ”€â”€ agent_engine_logs/     # æ—¥å¿—ç›®å½•
â”œâ”€â”€ main.go                # ç¨‹åºå…¥å£
â”œâ”€â”€ conf.yaml              # é…ç½®æ–‡ä»¶ï¼ˆéœ€è‡ªè¡Œåˆ›å»ºï¼‰
â””â”€â”€ README.md              # æœ¬æ–‡æ¡£
```

## å¼€å‘æŒ‡å—

### æ·»åŠ æ–°çš„äº‹ä»¶å¤„ç†å™¨

1. åœ¨ `agent/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„å¤„ç†å™¨æ–‡ä»¶ï¼Œä¾‹å¦‚ `custom_handler.go`
2. å®ç° `EventHandler` æ¥å£ï¼š

```go
type CustomHandler struct{}

func (h *CustomHandler) Handle(ctx context.Context, engine *Engine, params string, event string) (rsp any, err error) {
    // å®ç°ä½ çš„å¤„ç†é€»è¾‘
    return
}
```

3. åœ¨ `engine.go` çš„ `eventHandlerMap` ä¸­æ³¨å†Œæ–°å¤„ç†å™¨ï¼š

```go
var eventHandlerMap = map[string]EventHandler{
    "query": &QueryHandler{},
    "list":  &ListHandler{},
    "custom": &CustomHandler{}, // æ·»åŠ æ–°å¤„ç†å™¨
}
```

### æ‰©å±•é…ç½®

å¦‚éœ€æ·»åŠ æ–°çš„é…ç½®é¡¹ï¼Œä¿®æ”¹ `conf/config.go` ä¸­çš„ç»“æ„ä½“å®šä¹‰å³å¯ã€‚

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•åˆ‡æ¢ä¸åŒçš„æ¨¡å‹ï¼Ÿ

A: ä½¿ç”¨ `-m` å‚æ•°æŒ‡å®šæ¨¡å‹åç§°ï¼Œä¾‹å¦‚ï¼š
```bash
./agent_engine -c query -m deepseek-reasoner -p "ä½ çš„é—®é¢˜"
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ LLM æä¾›å•†ï¼Ÿ

A: åœ¨ `conf.yaml` ä¸­æ·»åŠ æ–°çš„æä¾›å•†é…ç½®å³å¯ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

### Q: ä¸ºä»€ä¹ˆæå–å­—æ®µæ—¶è¿”å›ç©ºï¼Ÿ

A: è¯·æ£€æŸ¥ JSONPath æ˜¯å¦æ­£ç¡®ã€‚ä½¿ç”¨ `-e $` æŸ¥çœ‹å®Œæ•´å“åº”ç»“æ„ï¼Œç„¶åæ ¹æ®å®é™…å­—æ®µè·¯å¾„æå–ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯ï¼Ÿ

A: æŸ¥çœ‹ `./agent_engine_logs/log.txt` æ—¥å¿—æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«è¯¦ç»†çš„è¿è¡Œä¿¡æ¯ã€‚

## ä¾èµ–é¡¹

ä¸»è¦ä¾èµ–ï¼š
- `github.com/openai/openai-go/v3` - OpenAI SDK
- `github.com/spf13/pflag` - å‘½ä»¤è¡Œå‚æ•°è§£æ
- `github.com/tidwall/gjson` - JSON è§£æå’Œæå–
- `github.com/MichaelMure/go-term-markdown` - Markdown æ¸²æŸ“
- `gopkg.in/yaml.v3` - YAML é…ç½®è§£æ
- `golang.org/x/term` - ç»ˆç«¯æ§åˆ¶

å®Œæ•´ä¾èµ–åˆ—è¡¨è¯·æŸ¥çœ‹ `go.mod` æ–‡ä»¶ã€‚

## è®¸å¯è¯

[è¯·æ ¹æ®å®é™…æƒ…å†µæ·»åŠ è®¸å¯è¯ä¿¡æ¯]

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è”ç³»æ–¹å¼

[è¯·æ ¹æ®å®é™…æƒ…å†µæ·»åŠ è”ç³»æ–¹å¼]